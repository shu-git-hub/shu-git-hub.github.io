<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>å˜èªå¸³ã‚¢ãƒ—ãƒª</title>
<style>
body { font-family:sans-serif; text-align:center; padding:30px; background:#f4f6f9; }
.card { background:white; padding:30px; border-radius:10px; max-width:500px; margin:auto; }
button { padding:10px 20px; margin:10px; border:none; cursor:pointer; }
.correct { background:#4CAF50; color:white; }
.incorrect { background:#f44336; color:white; }
.pass { background:#777; color:white; }
</style>
</head>
<body>

<h1>ğŸ“˜ å˜èªå¸³ã‚¢ãƒ—ãƒª</h1>

<div class="card">
  <h2 id="questionArea">èª­ã¿è¾¼ã¿ä¸­...</h2>
  <div id="answerArea" style="margin:20px;font-weight:bold;"></div>

  <button onclick="showAnswer()">ç­”ãˆã‚’è¦‹ã‚‹</button>

  <div id="resultButtons" style="display:none;">
    <button class="correct" onclick="record('correct')">æ­£è§£</button>
    <button class="incorrect" onclick="record('incorrect')">ä¸æ­£è§£</button>
    <button class="pass" onclick="record('pass')">ãƒ‘ã‚¹</button>
  </div>
</div>

<br>
<button onclick="location.href='register.html'">å•é¡Œç™»éŒ²</button>
<button onclick="location.href='list.html'">å•é¡Œä¸€è¦§</button>

<script>
let words = [];
let current = null;

/* =========================
   JSONåˆæœŸèª­ã¿è¾¼ã¿å‡¦ç†
========================= */
async function loadInitialData() {
  let existing = JSON.parse(localStorage.getItem("words"));

  if (!existing || existing.length === 0) {
    const response = await fetch("questions.json");
    const data = await response.json();

    const formatted = data.map(item => ({
      id: Date.now() + Math.random(),
      question: item.question,
      answer: item.answer,
      correct: 0,
      incorrect: 0,
      pass: 0
    }));

    localStorage.setItem("words", JSON.stringify(formatted));
    words = formatted;
  } else {
    words = existing;
  }

  loadRandom();
}

/* =========================
   ãƒ©ãƒ³ãƒ€ãƒ å‡ºé¡Œ
========================= */
function loadRandom() {
  if (words.length === 0) {
    document.getElementById("questionArea").textContent = "å•é¡ŒãŒã‚ã‚Šã¾ã›ã‚“";
    return;
  }

  current = words[Math.floor(Math.random() * words.length)];
  document.getElementById("questionArea").textContent = current.question;
  document.getElementById("answerArea").textContent = "";
  document.getElementById("resultButtons").style.display = "none";
}

function showAnswer() {
  if (!current) return;
  document.getElementById("answerArea").textContent = "ç­”ãˆ: " + current.answer;
  document.getElementById("resultButtons").style.display = "block";
}

function record(type) {
  let data = JSON.parse(localStorage.getItem("words")) || [];
  const index = data.findIndex(item => item.id === current.id);

  if (index !== -1) {
    data[index][type]++;
    localStorage.setItem("words", JSON.stringify(data));
  }

  words = data;
  loadRandom();
}

loadInitialData();
</script>

</body>
</html>
